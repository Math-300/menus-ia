{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///c:/Users/ASUS/OneDrive/Documentos/Men%C3%BAs%20IA/src/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr';\r\nimport { cookies } from 'next/headers';\r\n\r\nexport async function createClient() {\r\n    const cookieStore = await cookies();\r\n\r\n    return createServerClient(\r\n        process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n        {\r\n            cookies: {\r\n                getAll() {\r\n                    return cookieStore.getAll();\r\n                },\r\n                setAll(cookiesToSet) {\r\n                    try {\r\n                        cookiesToSet.forEach(({ name, value, options }) =>\r\n                            cookieStore.set(name, value, options)\r\n                        );\r\n                    } catch {\r\n                        // The `setAll` method was called from a Server Component.\r\n                        // This can be ignored if you have middleware refreshing sessions.\r\n                    }\r\n                },\r\n            },\r\n        }\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEO,eAAe;IAClB,MAAM,cAAc,MAAM,IAAA,4IAAO;IAEjC,OAAO,IAAA,iMAAkB,sUAGrB;QACI,SAAS;YACL;gBACI,OAAO,YAAY,MAAM;YAC7B;YACA,QAAO,YAAY;gBACf,IAAI;oBACA,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC1C,YAAY,GAAG,CAAC,MAAM,OAAO;gBAErC,EAAE,OAAM;gBACJ,0DAA0D;gBAC1D,kEAAkE;gBACtE;YACJ;QACJ;IACJ;AAER"}},
    {"offset": {"line": 77, "column": 0}, "map": {"version":3,"sources":["file:///c:/Users/ASUS/OneDrive/Documentos/Men%C3%BAs%20IA/src/app/api/admin/stories/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { createClient } from '@/lib/supabase/server';\r\n\r\n// GET /api/admin/stories - List all stories for the current tenant\r\nexport async function GET(request: NextRequest) {\r\n    try {\r\n        const supabase = await createClient();\r\n        const { searchParams } = new URL(request.url);\r\n        const type = searchParams.get('type');\r\n        const is_active = searchParams.get('is_active');\r\n\r\n        // Get authenticated user\r\n        const { data: { user }, error: authError } = await supabase.auth.getUser();\r\n\r\n        if (authError || !user) {\r\n            return NextResponse.json(\r\n                { error: 'No autorizado' },\r\n                { status: 401 }\r\n            );\r\n        }\r\n\r\n        // Get user's tenant_id\r\n        const { data: userData, error: userError } = await supabase\r\n            .from('users')\r\n            .select('tenant_id')\r\n            .eq('id', user.id)\r\n            .single();\r\n\r\n        if (userError || !userData?.tenant_id) {\r\n            return NextResponse.json(\r\n                { error: 'Usuario sin restaurante asociado' },\r\n                { status: 400 }\r\n            );\r\n        }\r\n\r\n        // Build query\r\n        let query = supabase\r\n            .from('stories')\r\n            .select(`\r\n                *,\r\n                dishes (id, name, price, image_url)\r\n            `)\r\n            .eq('tenant_id', userData.tenant_id)\r\n            .order('created_at', { ascending: false });\r\n\r\n        // Apply filters\r\n        if (type) {\r\n            query = query.eq('type', type);\r\n        }\r\n        if (is_active !== null && is_active !== undefined) {\r\n            query = query.eq('is_active', is_active === 'true');\r\n        }\r\n\r\n        const { data: stories, error: storiesError } = await query;\r\n\r\n        if (storiesError) {\r\n            console.error('Error fetching stories:', storiesError);\r\n            return NextResponse.json(\r\n                { error: 'Error al obtener stories' },\r\n                { status: 500 }\r\n            );\r\n        }\r\n\r\n        return NextResponse.json({ stories });\r\n    } catch (error) {\r\n        console.error('Unexpected error:', error);\r\n        return NextResponse.json(\r\n            { error: 'Error interno del servidor' },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n\r\n// POST /api/admin/stories - Create a new story\r\nexport async function POST(request: NextRequest) {\r\n    try {\r\n        const supabase = await createClient();\r\n        const body = await request.json();\r\n\r\n        // Get authenticated user\r\n        const { data: { user }, error: authError } = await supabase.auth.getUser();\r\n\r\n        if (authError || !user) {\r\n            return NextResponse.json(\r\n                { error: 'No autorizado' },\r\n                { status: 401 }\r\n            );\r\n        }\r\n\r\n        // Get user's tenant_id\r\n        const { data: userData, error: userError } = await supabase\r\n            .from('users')\r\n            .select('tenant_id')\r\n            .eq('id', user.id)\r\n            .single();\r\n\r\n        if (userError || !userData?.tenant_id) {\r\n            return NextResponse.json(\r\n                { error: 'Usuario sin restaurante asociado' },\r\n                { status: 400 }\r\n            );\r\n        }\r\n\r\n        const {\r\n            title,\r\n            type,\r\n            image_url,\r\n            video_url,\r\n            linked_dish_id,\r\n            is_active,\r\n            expires_at,\r\n        } = body;\r\n\r\n        // Validate required fields\r\n        if (!title || !type) {\r\n            return NextResponse.json(\r\n                { error: 'Título y tipo son requeridos' },\r\n                { status: 400 }\r\n            );\r\n        }\r\n\r\n        // Validate type\r\n        const validTypes = ['dish', 'promo', 'chef', 'event'];\r\n        if (!validTypes.includes(type)) {\r\n            return NextResponse.json(\r\n                { error: 'Tipo inválido. Debe ser: dish, promo, chef o event' },\r\n                { status: 400 }\r\n            );\r\n        }\r\n\r\n        // Create story\r\n        const { data: story, error: createError } = await supabase\r\n            .from('stories')\r\n            .insert({\r\n                tenant_id: userData.tenant_id,\r\n                title,\r\n                type,\r\n                image_url: image_url || null,\r\n                video_url: video_url || null,\r\n                linked_dish_id: linked_dish_id || null,\r\n                is_active: is_active !== undefined ? is_active : true,\r\n                expires_at: expires_at || null,\r\n                view_count: 0,\r\n            })\r\n            .select(`\r\n                *,\r\n                dishes (id, name, price, image_url)\r\n            `)\r\n            .single();\r\n\r\n        if (createError) {\r\n            console.error('Error creating story:', createError);\r\n            return NextResponse.json(\r\n                { error: 'Error al crear story' },\r\n                { status: 500 }\r\n            );\r\n        }\r\n\r\n        return NextResponse.json({ story }, { status: 201 });\r\n    } catch (error) {\r\n        console.error('Unexpected error:', error);\r\n        return NextResponse.json(\r\n            { error: 'Error interno del servidor' },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}