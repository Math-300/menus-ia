{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///c:/Users/ASUS/OneDrive/Documentos/Men%C3%BAs%20IA/src/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr';\r\nimport { cookies } from 'next/headers';\r\n\r\nexport async function createClient() {\r\n    const cookieStore = await cookies();\r\n\r\n    return createServerClient(\r\n        process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n        {\r\n            cookies: {\r\n                getAll() {\r\n                    return cookieStore.getAll();\r\n                },\r\n                setAll(cookiesToSet) {\r\n                    try {\r\n                        cookiesToSet.forEach(({ name, value, options }) =>\r\n                            cookieStore.set(name, value, options)\r\n                        );\r\n                    } catch {\r\n                        // The `setAll` method was called from a Server Component.\r\n                        // This can be ignored if you have middleware refreshing sessions.\r\n                    }\r\n                },\r\n            },\r\n        }\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEO,eAAe;IAClB,MAAM,cAAc,MAAM,IAAA,4IAAO;IAEjC,OAAO,IAAA,iMAAkB,sUAGrB;QACI,SAAS;YACL;gBACI,OAAO,YAAY,MAAM;YAC7B;YACA,QAAO,YAAY;gBACf,IAAI;oBACA,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC1C,YAAY,GAAG,CAAC,MAAM,OAAO;gBAErC,EAAE,OAAM;gBACJ,0DAA0D;gBAC1D,kEAAkE;gBACtE;YACJ;QACJ;IACJ;AAER"}},
    {"offset": {"line": 77, "column": 0}, "map": {"version":3,"sources":["file:///c:/Users/ASUS/OneDrive/Documentos/Men%C3%BAs%20IA/src/app/api/admin/tenant/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { createClient } from '@/lib/supabase/server';\r\n\r\n// GET /api/admin/tenant - Get tenant configuration\r\nexport async function GET() {\r\n    try {\r\n        const supabase = await createClient();\r\n\r\n        // Get authenticated user\r\n        const { data: { user }, error: authError } = await supabase.auth.getUser();\r\n\r\n        if (authError || !user) {\r\n            return NextResponse.json(\r\n                { error: 'No autorizado' },\r\n                { status: 401 }\r\n            );\r\n        }\r\n\r\n        // Get user's tenant_id\r\n        const { data: userData, error: userError } = await supabase\r\n            .from('users')\r\n            .select('tenant_id, role')\r\n            .eq('id', user.id)\r\n            .single();\r\n\r\n        if (userError || !userData?.tenant_id) {\r\n            return NextResponse.json(\r\n                { error: 'Usuario sin restaurante asociado' },\r\n                { status: 400 }\r\n            );\r\n        }\r\n\r\n        // Fetch tenant configuration\r\n        const { data: tenant, error: tenantError } = await supabase\r\n            .from('tenants')\r\n            .select('*')\r\n            .eq('id', userData.tenant_id)\r\n            .single();\r\n\r\n        if (tenantError) {\r\n            console.error('Error fetching tenant:', tenantError);\r\n            return NextResponse.json(\r\n                { error: 'Error al obtener configuraci칩n del restaurante' },\r\n                { status: 500 }\r\n            );\r\n        }\r\n\r\n        return NextResponse.json({ tenant, userRole: userData.role });\r\n    } catch (error) {\r\n        console.error('Unexpected error:', error);\r\n        return NextResponse.json(\r\n            { error: 'Error interno del servidor' },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n\r\n// PUT /api/admin/tenant - Update tenant configuration\r\nexport async function PUT(request: NextRequest) {\r\n    try {\r\n        const supabase = await createClient();\r\n        const body = await request.json();\r\n\r\n        // Get authenticated user\r\n        const { data: { user }, error: authError } = await supabase.auth.getUser();\r\n\r\n        if (authError || !user) {\r\n            return NextResponse.json(\r\n                { error: 'No autorizado' },\r\n                { status: 401 }\r\n            );\r\n        }\r\n\r\n        // Get user's tenant_id and verify role\r\n        const { data: userData, error: userError } = await supabase\r\n            .from('users')\r\n            .select('tenant_id, role')\r\n            .eq('id', user.id)\r\n            .single();\r\n\r\n        if (userError || !userData?.tenant_id) {\r\n            return NextResponse.json(\r\n                { error: 'Usuario sin restaurante asociado' },\r\n                { status: 400 }\r\n            );\r\n        }\r\n\r\n        // Only admins and owners can update tenant settings\r\n        if (userData.role !== 'admin' && userData.role !== 'owner') {\r\n            return NextResponse.json(\r\n                { error: 'No tienes permisos para actualizar la configuraci칩n' },\r\n                { status: 403 }\r\n            );\r\n        }\r\n\r\n        // Build update object with allowed fields\r\n        const allowedFields = [\r\n            'name',\r\n            'slug',\r\n            'logo_url',\r\n            'cover_url',\r\n            'primary_color',\r\n            'secondary_color',\r\n            'font_family',\r\n            'currency',\r\n            'locale',\r\n            'tagline',\r\n            'description',\r\n            'address',\r\n            'phone',\r\n            'whatsapp',\r\n            'hours',\r\n            'social_links',\r\n            'settings',\r\n        ];\r\n\r\n        const updateData: Record<string, unknown> = {};\r\n        for (const field of allowedFields) {\r\n            if (body[field] !== undefined) {\r\n                updateData[field] = body[field];\r\n            }\r\n        }\r\n\r\n        // Validate slug uniqueness if being updated\r\n        if (body.slug) {\r\n            const { data: existingSlug } = await supabase\r\n                .from('tenants')\r\n                .select('id')\r\n                .eq('slug', body.slug)\r\n                .neq('id', userData.tenant_id)\r\n                .single();\r\n\r\n            if (existingSlug) {\r\n                return NextResponse.json(\r\n                    { error: 'El slug ya est치 en uso por otro restaurante' },\r\n                    { status: 400 }\r\n                );\r\n            }\r\n        }\r\n\r\n        // Update tenant\r\n        const { data: tenant, error: updateError } = await supabase\r\n            .from('tenants')\r\n            .update(updateData)\r\n            .eq('id', userData.tenant_id)\r\n            .select()\r\n            .single();\r\n\r\n        if (updateError) {\r\n            console.error('Error updating tenant:', updateError);\r\n            return NextResponse.json(\r\n                { error: 'Error al actualizar configuraci칩n' },\r\n                { status: 500 }\r\n            );\r\n        }\r\n\r\n        return NextResponse.json({ tenant });\r\n    } catch (error) {\r\n        console.error('Unexpected error:', error);\r\n        return NextResponse.json(\r\n            { error: 'Error interno del servidor' },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}